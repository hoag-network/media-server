#!/usr/bin/env bash

set -e

use_tag="<%= @config['Docker']['dockerhub_id'] %>/<%= @config['Docker']['repo_name'] %>:<%= @config['Docker']['version'] %>"
use_dated_tag="${use_tag}-$(date -I)"
latest="<%= @config['Docker']['dockerhub_id'] %>/<%= @config['Docker']['repo_name'] %>:latest"

bash scripts/build.sh

docker tag "$use_tag" "$use_dated_tag" 
docker tag "$use_tag" "$latest"

bash scripts/docker-login.sh

docker push "$use_tag"
docker push "$use_dated_tag"
docker push "$latest"
